<div class="auth-page">
    <div class="bg"></div>

    <div class="logo">
        <mat-icon class="logo-icon">movie</mat-icon>
        <span class="logo-text">PulseScreen</span>
    </div>

    <mat-card class="auth-card error-card" appearance="outlined" *ngIf="!tokenValid">
        <div class="error-content">
            <mat-icon class="error-icon">error_outline</mat-icon>
            <h1>Invalid Link</h1>
            <p class="subtitle">This password reset link is invalid or has expired.</p>
            
            <button mat-flat-button color="primary" routerLink="/forgot-password">
                Request New Link
            </button>
            
            <div class="back-to-login">
                <a routerLink="/login" class="link">Back to Sign In</a>
            </div>
        </div>
    </mat-card>

    <mat-card class="auth-card" appearance="outlined" *ngIf="tokenValid">
        <h1>Reset Password</h1>
        <p class="subtitle">Enter your new password below.</p>
        
        <form [formGroup]="resetPasswordForm" (ngSubmit)="submit()" class="form">
            
            <mat-form-field appearance="outline" class="field">
                <mat-label>New Password</mat-label>
                <input matInput [type]="hidePassword ? 'password' : 'text'" formControlName="password">
                <mat-icon matPrefix>lock</mat-icon>

                <button mat-icon-button matSuffix type="button" (click)="hidePassword = !hidePassword"
                    [attr.aria-label]="'Hide password'" [attr.aria-pressed]="hidePassword">
                    <mat-icon>{{hidePassword ? 'visibility_off' : 'visibility'}}</mat-icon>
                </button>

                <mat-error *ngIf="resetPasswordForm.get('password')?.hasError('required')">
                    Password is required
                </mat-error>
                <mat-error *ngIf="resetPasswordForm.get('password')?.hasError('minlength')">
                    Password must be at least 6 characters
                </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline" class="field">
                <mat-label>Confirm New Password</mat-label>
                <input matInput [type]="hideConfirmPassword ? 'password' : 'text'" formControlName="confirmPassword">
                <mat-icon matPrefix>lock_outline</mat-icon>

                <button mat-icon-button matSuffix type="button" (click)="hideConfirmPassword = !hideConfirmPassword"
                    [attr.aria-label]="'Hide password'" [attr.aria-pressed]="hideConfirmPassword">
                    <mat-icon>{{hideConfirmPassword ? 'visibility_off' : 'visibility'}}</mat-icon>
                </button>

                <mat-error *ngIf="resetPasswordForm.get('confirmPassword')?.hasError('required')">
                    Confirm Password is required
                </mat-error>
                <mat-error *ngIf="resetPasswordForm.hasError('passwordMismatch') && !resetPasswordForm.get('confirmPassword')?.hasError('required')">
                    Passwords do not match
                </mat-error>
            </mat-form-field>

            <button mat-flat-button class="submit-btn" type="submit" [disabled]="loading || !resetPasswordForm.valid">
                {{ loading ? 'Resetting...' : 'Reset Password' }}
            </button>
            
            <div class="back-to-login">
                <a routerLink="/login" class="link">Back to Sign In</a>
            </div>
        </form>
    </mat-card>
</div>